"use strict";angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(e){if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");var n=function(e,n,a){angular.isDefined(a.showGutter)&&e.renderer.setShowGutter(a.showGutter),angular.isDefined(a.useWrapMode)&&n.setUseWrapMode(a.useWrapMode),angular.isDefined(a.showInvisibles)&&e.renderer.setShowInvisibles(a.showInvisibles),angular.isDefined(a.showIndentGuides)&&e.renderer.setDisplayIndentGuides(a.showIndentGuides),angular.isDefined(a.useSoftTabs)&&n.setUseSoftTabs(a.useSoftTabs),angular.isDefined(a.disableSearch)&&a.disableSearch&&e.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isFunction(a.onLoad)&&a.onLoad(e),angular.isString(a.theme)&&e.setTheme("ace/theme/"+a.theme),angular.isString(a.mode)&&n.setMode("ace/mode/"+a.mode)};return{restrict:"EA",require:"?ngModel",link:function(a,r,i,o){var t,u,s=e.ace||{},l=angular.extend({},s,a.$eval(i.uiAce)),d=window.ace.edit(r[0]),c=d.getSession(),f=function(){var e=arguments[0],n=Array.prototype.slice.call(arguments,1);angular.isDefined(e)&&a.$apply(function(){if(!angular.isFunction(e))throw new Error("ui-ace use a function as callback.");e(n)})},g={onChange:function(e){return function(n){var r=c.getValue();r===a.$eval(i.value)||a.$$phase||a.$root.$$phase||(angular.isDefined(o)&&a.$apply(function(){o.$setViewValue(r)}),f(e,n,d))}},onBlur:function(e){return function(){f(e,d)}}};i.$observe("readonly",function(e){d.setReadOnly("true"===e)}),angular.isDefined(o)&&(o.$formatters.push(function(e){if(angular.isUndefined(e)||null===e)return"";if(angular.isObject(e)||angular.isArray(e))throw new Error("ui-ace cannot use an object or an array as a model");return e}),o.$render=function(){c.setValue(o.$viewValue)}),n(d,c,l),a.$watch(i.uiAce,function(){l=angular.extend({},s,a.$eval(i.uiAce)),c.removeListener("change",t),t=g.onChange(l.onChange),c.on("change",t),d.removeListener("blur",u),u=g.onBlur(l.onBlur),d.on("blur",u),n(d,c,l)},!0),t=g.onChange(l.onChange),c.on("change",t),u=g.onBlur(l.onBlur),d.on("blur",u),r.on("$destroy",function(){d.session.$stopWorker(),d.destroy()}),a.$watch(function(){return[r[0].offsetWidth,r[0].offsetHeight]},function(){d.resize(),d.renderer.updateFull()},!0)}}}]);